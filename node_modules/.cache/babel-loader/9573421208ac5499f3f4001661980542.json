{"ast":null,"code":"import _toConsumableArray from\"C:/Users/admin/Documents/Workspace/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/admin/Documents/Workspace/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect}from'react';import{useSelector}from'react-redux';import'../scss/components/Notification.css';import Notificationcard from'./Card/Notificationcard';import{useDispatch}from'react-redux';import{getAllNotificationsAsync}from'../redux/Slices/NotificationSlice';import{Link}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Notification=function Notification(_ref){var socket=_ref.socket;var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isDisplay=_React$useState2[0],setIsDisplay=_React$useState2[1];var dispatch=useDispatch();var _React$useState3=React.useState([]),_React$useState4=_slicedToArray(_React$useState3,2),notifications=_React$useState4[0],setNotifications=_React$useState4[1];var handleNotification=function handleNotification(){setIsDisplay(!isDisplay);};useEffect(function(){console.log(\"useEffect1\");dispatch(getAllNotificationsAsync()).then(function(res){var allNotifsfromAPI=res.payload.data.data.notifications;var allNotifs=[];allNotifsfromAPI.forEach(function(element){allNotifs.push({sender:element.sender.name,senderId:element.sender._id,receivers:element.receivers,content:element.content,isMessage:element.isMessage,receiverChat:element.receiverChat,Seen:element.Seen});});console.log(allNotifs);setNotifications(allNotifs);});},[1]);useEffect(function(){console.log(\"use effect\");var tempNotifs=_toConsumableArray(notifications);socket.on(\"receive_notification\",function(data){console.log(data.senderId);var index=tempNotifs.findIndex(function(notif){return notif.senderId===data.senderId;});console.log(index);console.log(tempNotifs);if(index>=0){tempNotifs[index].content=data.content;setNotifications(tempNotifs);}else{setNotifications(function(prev){return[data].concat(_toConsumableArray(prev));});}});},[socket,notifications]);console.log(notifications);var listNotifications=notifications===null||notifications===void 0?void 0:notifications.map(function(notification){return/*#__PURE__*/_jsx(Link,{to:\"/Message_ChatWindow/\".concat(notification.receiverChat),style:{textDecoration:'none',color:'black'},children:/*#__PURE__*/_jsx(Notificationcard,{name:notification.sender,date:\"2021-06-01\",content:notification.content,chatId:notification.receiverChat})});});return/*#__PURE__*/_jsxs(\"div\",{className:\"notification\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"notification-bell\",onClick:handleNotification,children:[/*#__PURE__*/_jsx(\"div\",{class:\"notification-circle\",children:\"4\"}),/*#__PURE__*/_jsx(\"i\",{class:\"fa-solid fa-bell fa-xl\"})]}),isDisplay&&/*#__PURE__*/_jsx(\"div\",{className:\"notification-list\",children:listNotifications})]});};export default Notification;","map":{"version":3,"names":["React","useEffect","useSelector","Notificationcard","useDispatch","getAllNotificationsAsync","Link","Notification","socket","useState","isDisplay","setIsDisplay","dispatch","notifications","setNotifications","handleNotification","console","log","then","res","allNotifsfromAPI","payload","data","allNotifs","forEach","element","push","sender","name","senderId","_id","receivers","content","isMessage","receiverChat","Seen","tempNotifs","on","index","findIndex","notif","prev","listNotifications","map","notification","textDecoration","color"],"sources":["C:/Users/admin/Documents/Workspace/client/src/components/Notification.js"],"sourcesContent":["import React, { useEffect } from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport '../scss/components/Notification.css'\r\nimport Notificationcard from './Card/Notificationcard'\r\nimport { useDispatch } from 'react-redux'\r\nimport { getAllNotificationsAsync } from '../redux/Slices/NotificationSlice'\r\nimport { Link } from \"react-router-dom\";\r\n\r\n\r\nconst Notification = ({ socket }) => {\r\n  const [isDisplay, setIsDisplay] = React.useState(false);\r\n  const dispatch = useDispatch();\r\n  const [notifications, setNotifications] = React.useState([]);\r\n  const handleNotification = () => {\r\n    setIsDisplay(!isDisplay);\r\n  };\r\n  useEffect(() => {\r\n    console.log(\"useEffect1\");\r\n    dispatch(getAllNotificationsAsync()).then((res) => {\r\n      const allNotifsfromAPI = res.payload.data.data.notifications;\r\n      let allNotifs = [];\r\n      allNotifsfromAPI.forEach((element) => {\r\n        allNotifs.push({\r\n          sender: element.sender.name,\r\n          senderId: element.sender._id,\r\n          receivers: element.receivers,\r\n          content: element.content,\r\n          isMessage: element.isMessage,\r\n          receiverChat: element.receiverChat,\r\n          Seen: element.Seen,\r\n        });\r\n      });\r\n      console.log(allNotifs);\r\n      setNotifications(allNotifs);\r\n    });\r\n  }, [1]);\r\n  useEffect(() => {\r\n    console.log(\"use effect\");\r\n     let tempNotifs = [...notifications];\r\n    socket.on(\"receive_notification\", (data) => {\r\n      console.log(data.senderId);\r\n      const index = tempNotifs.findIndex((notif) => notif.senderId === data.senderId);\r\n      console.log(index); \r\n      console.log(tempNotifs);\r\n      if (index >= 0) {\r\n        tempNotifs[index].content = data.content;\r\n        setNotifications(tempNotifs);\r\n      } else {\r\n         setNotifications((prev) => [data, ...prev]);\r\n      }\r\n    });\r\n    \r\n  }, [socket, notifications]);\r\n  console.log(notifications);\r\n  const listNotifications = notifications?.map((notification) => {\r\n    return (\r\n      <Link to={`/Message_ChatWindow/${notification.receiverChat}`} style={{ textDecoration: 'none', color: 'black' }}>\r\n      <Notificationcard name={notification.sender} date={\"2021-06-01\"} content={notification.content} chatId={notification.receiverChat}\r\n        />\r\n      </Link>\r\n    );\r\n  });\r\n  return (\r\n    <div className=\"notification\">\r\n      <div className=\"notification-bell\" onClick={handleNotification}>\r\n        <div class=\"notification-circle\">4</div>\r\n        <i class=\"fa-solid fa-bell fa-xl\"></i>\r\n      </div>\r\n      {isDisplay &&\r\n        <div className=\"notification-list\">\r\n            {listNotifications}\r\n        </div>\r\n      }\r\n    </div>\r\n  );\r\n}\r\nexport default Notification;"],"mappings":"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"},"metadata":{},"sourceType":"module"}